<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, viewport-fit=cover"
  />
  <title>CaFES Check – Identificación de concesionario</title>

  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="app-container">
    <section class="screen identification-screen">
      <header class="screen-header">
        <button class="back-button" onclick="location.href='index.html'">←</button>
        <span class="screen-title">Identificación de concesionario</span>
      </header>

      <p class="identificacion-intro">
        Antes de levantar un reporte necesitamos identificar el concesionario
        y registrar evidencia del lugar en este momento.
      </p>

      <div class="identification-layout">

        <!-- PASO 1: FOTO -->
        <div class="ident-card" data-step="1">
          <h2 class="form-title">1. Toma una fotografía</h2>
          <p class="ident-text">
            Usa la cámara de tu dispositivo para capturar una imagen del área
            o del problema. No se permite seleccionar imágenes de la galería.
          </p>

          <div class="camera-box">
            <video
              id="camera-preview"
              autoplay
              playsinline
              class="camera-preview">
            </video>
            <canvas id="photo-canvas" class="hidden"></canvas>
            <img
              id="photo-preview"
              class="photo-preview hidden"
              alt="Vista previa de la fotografía" />
          </div>

          <div class="camera-buttons">
            <button id="btn-start-camera" class="btn btn-secondary">
              Activar cámara
            </button>
            <button id="btn-take-photo" class="btn btn-primary hidden">
              Tomar fotografía
            </button>
            <button id="btn-retake-photo" class="btn btn-secondary hidden">
              Volver a tomar
            </button>
          </div>
        </div>

        <!-- PASO 2: QR -->
        <div class="ident-card" data-step="2">
          <h2 class="form-title">2. Escanea el QR del concesionario</h2>
          <p class="ident-text">
            Acerca el código QR del concesionario (pegado en la cafetería).
            Al escanearlo, llenaremos automáticamente los datos.
          </p>

          <div class="camera-buttons">
            <button id="btn-start-qr" class="btn btn-secondary full-width">
              Activar escáner QR
            </button>
          </div>

          <div id="qr-reader" class="qr-box"></div>

          <!-- TEXTO QUE SE VE ANTES DE ESCANEAR -->
          <p id="qr-hint" class="ident-text" style="margin-top: 10px; opacity: 0.8;">
            Escanea el QR para ver los datos del concesionario.
          </p>

          <!-- FORMULARIO OCULTO HASTA QUE EL QR SEA VÁLIDO -->
          <div id="concesionario-datos" class="signup-form concesionario-form hidden">

            <div class="form-group">
              <label for="campo-num-aut">Número autorizado</label>
              <input type="text" id="campo-num-aut" readonly />
            </div>

            <div class="form-group">
              <label for="campo-dependencia">Dependencia</label>
              <input type="text" id="campo-dependencia" readonly />
            </div>

            <div class="form-group">
              <label for="campo-localidad">Localidad</label>
              <input type="text" id="campo-localidad" readonly />
            </div>

            <div class="form-group">
              <label for="campo-autorizado">Autorizado</label>
              <input type="text" id="campo-autorizado" readonly />
            </div>

            <div class="form-group">
              <label for="campo-horario">Horario</label>
              <input type="text" id="campo-horario" readonly />
            </div>

          </div>
        </div>
      </div>

      <!-- PASO 3: PANEL DE REPORTE (SE MUESTRA SOLO CUANDO HAY FOTO + QR) -->
      <section id="incident-panel" class="incident-panel hidden">
        <div class="incident-header">
          <span class="incident-step-badge">PASO 3</span>
          <h2 class="incident-title">Reporta un incidente</h2>
          <p class="incident-subtitle">
            Selecciona el tipo de problema y cuéntanos brevemente qué ocurrió.
          </p>
        </div>

        <form id="incident-form" class="incident-form">
          <!-- tipo seleccionado (se llena con los botones) -->
          <input type="hidden" id="incident-type" />

          <div class="incident-tags">
            <button type="button" class="incident-tag" data-type="higiene">
              Malas prácticas de higiene
            </button>
            <button type="button" class="incident-tag" data-type="comida-mal-estado">
              Comida en mal estado
            </button>
            <button type="button" class="incident-tag" data-type="trato-inadecuado">
              Trato inadecuado
            </button>
            <button type="button" class="incident-tag" data-type="precios-injustos">
              Precios injustos
            </button>
            <button type="button" class="incident-tag" data-type="productos-caducados">
              Productos caducados
            </button>
            <button type="button" class="incident-tag" data-type="malas-condiciones">
              Malas condiciones en instalaciones
            </button>
            <button type="button" class="incident-tag" data-type="uso-areas-no-designadas">
              Uso de áreas no designadas
            </button>
            <button type="button" class="incident-tag" data-type="maquinas-expendedoras">
              Máquinas expendedoras
            </button>
            <button type="button" class="incident-tag" data-type="seguridad-proteccion-civil">
              Falta de seguridad y protección civil
            </button>
            <button type="button" class="incident-tag" data-type="porciones-inadecuadas">
              Porciones inadecuadas
            </button>
          </div>

          <label class="incident-label" for="incident-detalles">
            Describe brevemente lo que pasó
          </label>
          <textarea
            id="incident-detalles"
            class="incident-textarea"
            rows="4"
            placeholder="Ejemplo: Encontré comida en mal estado en la vitrina de postres cerca de la caja 2..."
          ></textarea>

          <button type="submit" class="btn btn-primary full-width incident-submit">
            Enviar reporte
          </button>
        </form>
      </section>

    </section>
  </div>

  <!-- Scripts al final -->
  <script src="https://unpkg.com/html5-qrcode"></script>
  <script src="api-config.js"></script>
  <script src="identification-updated.js"></script>
</body>
</html>
